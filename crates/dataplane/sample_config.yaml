# Indexify Dataplane Configuration

# Environment name (e.g., "local", "staging", "production")
# When set to anything other than "local", structured JSON logging is enabled
env: local

# Unique identifier for this executor (auto-generated UUID if not specified)
# executor_id: "executor-1"

# The gRPC server address to connect to
server_addr: 'http://localhost:8901'

# TLS configuration for authenticating with the gRPC server
tls:
  # Enable TLS for gRPC connections
  enabled: false
  # Path to the CA certificate file (PEM format) - used to verify the server's certificate
  # ca_cert_path: "/etc/certs/ca.pem"
  # Path to the client certificate file (PEM format) - required for mTLS
  # client_cert_path: "/etc/certs/client.pem"
  # Path to the client private key file (PEM format) - required for mTLS
  # client_key_path: "/etc/certs/client-key.pem"
  # Domain name to use for TLS verification (optional)
  # domain_name: "indexify.example.com"

# Telemetry configuration
telemetry:
  # OpenTelemetry tracing exporter: "stdout" or "otlp"
  # tracing_exporter: otlp
  # OpenTelemetry collector endpoint (defaults to OTEL_EXPORTER_OTLP_ENDPOINT or localhost:4317)
  # endpoint: "http://otel-collector:4317"
  # Instance ID for this dataplane instance (auto-generated if not specified)
  # instance_id: "dataplane-1"

# Process driver configuration
# Options: "fork_exec" (default), "docker", or "firecracker"
driver:
  type: docker
  # For docker driver:
  # type: docker
  # address: "unix:///var/run/docker.sock"
  # runtime: runsc     # OCI runtime (e.g., runsc for gVisor)
  # network: bridge    # Docker network mode
  # binds:             # Volume bind mounts for containers
  #   - "/host/path:/container/path:ro"

  # For firecracker driver (requires --features firecracker):
  # type: firecracker
  # kernel_image_path: /opt/firecracker/vmlinux           # Path to uncompressed Linux kernel
  # base_rootfs_image: /opt/firecracker/rootfs.ext4       # Path to base ext4 rootfs image
  # cni_network_name: indexify-fc                         # CNI network name (must match conflist)
  # guest_gateway: "192.168.30.1"                         # Gateway IP for guest networking
  # firecracker_binary: firecracker                       # Path to firecracker binary (default: PATH lookup)
  # default_rootfs_size_bytes: 1073741824                 # Per-VM COW file size (default: 1 GiB)
  # cni_bin_path: /opt/cni/bin                            # CNI plugin binaries directory
  # guest_netmask: "255.255.255.0"                        # Guest network mask
  # default_vcpu_count: 2                                 # vCPUs per VM
  # default_memory_mib: 512                               # Memory per VM in MiB
  # state_dir: /var/lib/indexify/firecracker              # VM metadata, sockets, COW overlays
  # log_dir: /var/log/indexify/firecracker                # VM log directory

# Snapshot storage URI for container filesystem snapshots.
# Enables snapshot create/restore for both Docker and Firecracker drivers.
# For Docker: exports container filesystem → zstd → blob store
# For Firecracker: reads dm-snapshot COW file → zstd → blob store
# Examples:
#   snapshot_storage_uri: "s3://my-bucket/snapshots"
#   snapshot_storage_uri: "file:///var/data/snapshots"

# Default container image for function containers.
# Used as a fallback when no external image resolution service is configured.
# default_function_image: "python:3.10-slim"

# HTTP proxy configuration for sandbox routing
# Receives requests from sandbox-proxy with Tensorlake-Sandbox-Id header
http_proxy:
  # Port to listen on (default: 8095)
  port: 8095
  # Listen address (default: 0.0.0.0)
  listen_addr: '0.0.0.0'
  # Address to advertise to the server (defaults to hostname:port)
  # IMPORTANT: For local development, set this to 127.0.0.1:port
  # so sandbox-proxy can reach the dataplane
  advertise_address: '127.0.0.1:8095'

monitoring:
  # Port to listen on for HTTP monitoring requests (default: 8100)
  port: 8099
  # Listen address (default: 0.0.0.0)
  listen_addr: '0.0.0.0'
